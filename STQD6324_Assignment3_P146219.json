{"paragraphs":[{"text":"%md\n# This assignment is an analysis on the Movielens 100k Dataset, using Spark2 SQL and Cassandra Query Language.","user":"anonymous","dateUpdated":"2025-07-25T10:38:51+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439839646_490846625","id":"20250725-103719_443320255","dateCreated":"2025-07-25T10:37:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12201","dateFinished":"2025-07-25T10:38:51+0000","dateStarted":"2025-07-25T10:38:51+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>This assignment is an analysis on the Movielens 100k Dataset, using Spark2 SQL and Cassandra Query Language.</h1>\n"}]}},{"title":"Download u.user into Local Temp Folder","text":"%sh\r\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.user -O /tmp/u.user\r\necho \"Downloaded u.user file from ml-100k dataset!\"","user":"anonymous","dateUpdated":"2025-07-25T10:12:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-07-25 09:47:03--  http://media.sundog-soft.com/hadoop/ml-100k/u.user\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.216.12.108, 52.216.62.9, 16.15.217.187, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.216.12.108|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22628 (22K) [text/plain]\nSaving to: ‘/tmp/u.user\\r’\n\n     0K .......... .......... ..                              100% 82.7K=0.3s\n\n2025-07-25 09:47:05 (82.7 KB/s) - ‘/tmp/u.user\\r’ saved [22628/22628]\n\nDownloaded u.user file from ml-100k dataset!\n"}]},"apps":[],"jobName":"paragraph_1753436359105_-2107986873","id":"20250725-093919_1274753587","dateCreated":"2025-07-25T09:39:19+0000","dateStarted":"2025-07-25T09:47:02+0000","dateFinished":"2025-07-25T09:47:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8696"},{"title":"Upload u.user to HDFS","text":"%sh\n%sh\nhdfs dfs -mkdir -p /user/movielens\nhdfs dfs -put -f /tmp/u.user /user/movielens/\necho \"u.user uploaded to HDFS: /user/movielens/u.user\"","user":"anonymous","dateUpdated":"2025-07-25T10:12:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bash: line 0: fg: no job control\nu.user uploaded to HDFS: /user/movielens/u.user\n"}]},"apps":[],"jobName":"paragraph_1753436822239_-126102605","id":"20250725-094702_309869595","dateCreated":"2025-07-25T09:47:02+0000","dateStarted":"2025-07-25T09:47:37+0000","dateFinished":"2025-07-25T09:47:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8697"},{"title":"Read and Parse u.user with Spark","text":"%pyspark\r\n\r\nfrom pyspark.sql.types import StructType, StructField, IntegerType, StringType\r\n\r\n# Define schema\r\nuser_schema = StructType([\r\n    StructField(\"user_id\", IntegerType(), True),\r\n    StructField(\"age\", IntegerType(), True),\r\n    StructField(\"gender\", StringType(), True),\r\n    StructField(\"occupation\", StringType(), True),\r\n    StructField(\"zip_code\", StringType(), True)\r\n])\r\n\r\n# Load data into Spark DataFrame\r\nusers_df = spark.read.option(\"delimiter\", \"|\").schema(user_schema).csv(\"hdfs:///user/movielens/u.user\")\r\n\r\n# Show some users\r\nusers_df.show(10)","user":"anonymous","dateUpdated":"2025-07-25T10:12:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+--------+\n|user_id|age|gender|   occupation|zip_code|\n+-------+---+------+-------------+--------+\n|      1| 24|     M|   technician|   85711|\n|      2| 53|     F|        other|   94043|\n|      3| 23|     M|       writer|   32067|\n|      4| 24|     M|   technician|   43537|\n|      5| 33|     F|        other|   15213|\n|      6| 42|     M|    executive|   98101|\n|      7| 57|     M|administrator|   91344|\n|      8| 36|     M|administrator|   05201|\n|      9| 29|     M|      student|   01002|\n|     10| 53|     M|       lawyer|   90703|\n+-------+---+------+-------------+--------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1753436857773_2022612732","id":"20250725-094737_2109428274","dateCreated":"2025-07-25T09:47:37+0000","dateStarted":"2025-07-25T09:48:07+0000","dateFinished":"2025-07-25T09:48:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8698"},{"text":"%sh\r\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\r\necho \"Downloaded u.item file from ml-100k dataset!\"","user":"anonymous","dateUpdated":"2025-07-25T10:12:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753436887855_-625598623","id":"20250725-094807_1746861307","dateCreated":"2025-07-25T09:48:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8699","dateFinished":"2025-07-25T10:01:10+0000","dateStarted":"2025-07-25T10:01:08+0000","title":"Download u.item into Local Temp Folder","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-07-25 10:01:08--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 3.5.25.106, 3.5.16.126, 52.217.126.33, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|3.5.25.106|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item\\r’\n\n     0K .......... .......... .......... .......... .......... 21% 74.6K 2s\n    50K .......... .......... .......... .......... .......... 43%  148K 1s\n   100K .......... .......... .......... .......... .......... 64% 11.3M 1s\n   150K .......... .......... .......... .......... .......... 86% 10.3M 0s\n   200K .......... .......... ..........                      100% 93.4K=1.3s\n\n2025-07-25 10:01:10 (171 KB/s) - ‘/tmp/u.item\\r’ saved [236344/236344]\n\nDownloaded u.item file from ml-100k dataset!\n"}]}},{"text":"%sh\r\nhdfs dfs -put -f /tmp/u.item /user/movielens/","user":"anonymous","dateUpdated":"2025-07-25T10:12:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753437668357_-970491518","id":"20250725-100108_974572160","dateCreated":"2025-07-25T10:01:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8849","dateFinished":"2025-07-25T10:02:01+0000","dateStarted":"2025-07-25T10:02:00+0000","title":"Move u.item into HDFS","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.types import StructType, StructField, IntegerType, StringType\r\n\r\n# Schema for u.item\r\nitem_schema = StructType([\r\n    StructField(\"movieid\", IntegerType(), True),\r\n    StructField(\"title\", StringType(), True),\r\n    StructField(\"release_date\", StringType(), True),\r\n    StructField(\"video_release_date\", StringType(), True),\r\n    StructField(\"imdb_url\", StringType(), True),\r\n    StructField(\"unknown\", IntegerType(), True),\r\n    StructField(\"action\", IntegerType(), True),\r\n    StructField(\"adventure\", IntegerType(), True),\r\n    StructField(\"animation\", IntegerType(), True),\r\n    StructField(\"children\", IntegerType(), True),\r\n    StructField(\"comedy\", IntegerType(), True),\r\n    StructField(\"crime\", IntegerType(), True),\r\n    StructField(\"documentary\", IntegerType(), True),\r\n    StructField(\"drama\", IntegerType(), True),\r\n    StructField(\"fantasy\", IntegerType(), True),\r\n    StructField(\"film_noir\", IntegerType(), True),\r\n    StructField(\"horror\", IntegerType(), True),\r\n    StructField(\"musical\", IntegerType(), True),\r\n    StructField(\"mystery\", IntegerType(), True),\r\n    StructField(\"romance\", IntegerType(), True),\r\n    StructField(\"sci_fi\", IntegerType(), True),\r\n    StructField(\"thriller\", IntegerType(), True),\r\n    StructField(\"war\", IntegerType(), True),\r\n    StructField(\"western\", IntegerType(), True)\r\n])\r\n\r\n# Load into DataFrame\r\ntitles_df = spark.read.option(\"delimiter\", \"|\").schema(item_schema).csv(\"hdfs:///user/movielens/u.item\")\r\n\r\n# Preview\r\ntitles_df.show(5)","user":"anonymous","dateUpdated":"2025-07-25T10:12:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753437719530_1722979001","id":"20250725-100159_2133360315","dateCreated":"2025-07-25T10:01:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8960","dateFinished":"2025-07-25T10:02:40+0000","dateStarted":"2025-07-25T10:02:40+0000","title":"Read u.item into Spark DataFrame python Copy Edit","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+------------+------------------+--------------------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\n|movieid|            title|release_date|video_release_date|            imdb_url|unknown|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|film_noir|horror|musical|mystery|romance|sci_fi|thriller|war|western|\n+-------+-----------------+------------+------------------+--------------------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\n|      1| Toy Story (1995)| 01-Jan-1995|              null|http://us.imdb.co...|      0|     0|        0|        1|       1|     1|    0|          0|    0|      0|        0|     0|      0|      0|      0|     0|       0|  0|      0|\n|      2| GoldenEye (1995)| 01-Jan-1995|              null|http://us.imdb.co...|      0|     1|        1|        0|       0|     0|    0|          0|    0|      0|        0|     0|      0|      0|      0|     0|       1|  0|      0|\n|      3|Four Rooms (1995)| 01-Jan-1995|              null|http://us.imdb.co...|      0|     0|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|      0|      0|      0|     0|       1|  0|      0|\n|      4|Get Shorty (1995)| 01-Jan-1995|              null|http://us.imdb.co...|      0|     1|        0|        0|       0|     1|    0|          0|    1|      0|        0|     0|      0|      0|      0|     0|       0|  0|      0|\n|      5|   Copycat (1995)| 01-Jan-1995|              null|http://us.imdb.co...|      0|     0|        0|        0|       0|     0|    1|          0|    1|      0|        0|     0|      0|      0|      0|     0|       1|  0|      0|\n+-------+-----------------+------------+------------------+--------------------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\nonly showing top 5 rows\n\n"}]}},{"text":"%sh\r\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data\r\nhdfs dfs -put -f /tmp/u.data /user/movielens/","user":"anonymous","dateUpdated":"2025-07-25T10:07:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753437855705_1812441604","id":"20250725-100415_1644358504","dateCreated":"2025-07-25T10:04:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9135","dateFinished":"2025-07-25T10:07:31+0000","dateStarted":"2025-07-25T10:07:25+0000","title":"Download & Upload u.data to HDFS","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-07-25 10:07:25--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 3.5.20.154, 52.217.172.217, 52.217.115.193, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|3.5.20.154|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data\\r’\n\n     0K .......... .......... .......... .......... ..........  2%  102K 19s\n    50K .......... .......... .......... .......... ..........  4%  204K 14s\n   100K .......... .......... .......... .......... ..........  7% 15.5M 9s\n   150K .......... .......... .......... .......... ..........  9% 11.2M 7s\n   200K .......... .......... .......... .......... .......... 12%  209K 7s\n   250K .......... .......... .......... .......... .......... 14% 10.2M 6s\n   300K .......... .......... .......... .......... .......... 17% 12.7M 5s\n   350K .......... .......... .......... .......... .......... 19% 69.2K 7s\n   400K .......... .......... .......... .......... .......... 22% 7.38M 6s\n   450K .......... .......... .......... .......... .......... 24% 27.1M 5s\n   500K .......... .......... .......... .......... .......... 27% 34.3M 5s\n   550K .......... .......... .......... .......... .......... 29% 59.7M 4s\n   600K .......... .......... .......... .......... .......... 32% 70.9M 4s\n   650K .......... .......... .......... .......... .......... 34% 63.9M 3s\n   700K .......... .......... .......... .......... .......... 36% 58.9M 3s\n   750K .......... .......... .......... .......... .......... 39% 36.8M 3s\n   800K .......... .......... .......... .......... .......... 41% 54.5M 2s\n   850K .......... .......... .......... .......... .......... 44%  218K 2s\n   900K .......... .......... .......... .......... .......... 46% 11.5M 2s\n   950K .......... .......... .......... .......... .......... 49%  198K 2s\n  1000K .......... .......... .......... .......... .......... 51%  214K 2s\n  1050K .......... .......... .......... .......... .......... 54% 10.6M 2s\n  1100K .......... .......... .......... .......... .......... 56% 13.1M 2s\n  1150K .......... .......... .......... .......... .......... 59% 28.6M 2s\n  1200K .......... .......... .......... .......... .......... 61% 57.9M 2s\n  1250K .......... .......... .......... .......... .......... 64% 94.3M 1s\n  1300K .......... .......... .......... .......... .......... 66% 18.0M 1s\n  1350K .......... .......... .......... .......... .......... 68%  215K 1s\n  1400K .......... .......... .......... .......... .......... 71% 10.3M 1s\n  1450K .......... .......... .......... .......... .......... 73% 10.9M 1s\n  1500K .......... .......... .......... .......... .......... 76% 12.1M 1s\n  1550K .......... .......... .......... .......... .......... 78%  216K 1s\n  1600K .......... .......... .......... .......... .......... 81% 10.4M 1s\n  1650K .......... .......... .......... .......... .......... 83% 11.8M 1s\n  1700K .......... .......... .......... .......... .......... 86% 8.42M 0s\n  1750K .......... .......... .......... .......... .......... 88%  218K 0s\n  1800K .......... .......... .......... .......... .......... 91% 8.31M 0s\n  1850K .......... .......... .......... .......... .......... 93% 14.1M 0s\n  1900K .......... .......... .......... .......... .......... 96% 8.31M 0s\n  1950K .......... .......... .......... .......... .......... 98%  226K 0s\n  2000K .......... .......... ..........                      100% 2.88M=3.4s\n\n2025-07-25 10:07:29 (592 KB/s) - ‘/tmp/u.data\\r’ saved [2079229/2079229]\n\n"}]}},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.types import StructType, StructField, IntegerType, StringType\r\n\r\nratings_schema = StructType([\r\n    StructField(\"user_id\", IntegerType(), True),\r\n    StructField(\"movieid\", IntegerType(), True),\r\n    StructField(\"rating\", IntegerType(), True),\r\n    StructField(\"timestamp\", StringType(), True)\r\n])\r\n\r\nratings_df = spark.read.option(\"delimiter\", \"\\t\").schema(ratings_schema).csv(\"hdfs:///user/movielens/u.data\")\r\n\r\nratings_df.show(5)","user":"anonymous","dateUpdated":"2025-07-25T10:07:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438045257_-2028831762","id":"20250725-100725_1760015869","dateCreated":"2025-07-25T10:07:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9276","dateFinished":"2025-07-25T10:08:01+0000","dateStarted":"2025-07-25T10:07:59+0000","title":"Parse u.data as Spark DataFrame","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+---------+\n|user_id|movieid|rating|timestamp|\n+-------+-------+------+---------+\n|      0|     50|     5|881250949|\n|      0|    172|     5|881250949|\n|      0|    133|     1|881250949|\n|    196|    242|     3|881250949|\n|    186|    302|     3|891717742|\n+-------+-------+------+---------+\nonly showing top 5 rows\n\n"}]}},{"text":"%pyspark\n\nratings_df_clean = ratings_df.drop(\"timestamp\")","user":"anonymous","dateUpdated":"2025-07-25T10:15:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438488949_1377959405","id":"20250725-101448_341221470","dateCreated":"2025-07-25T10:14:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9642","dateFinished":"2025-07-25T10:15:33+0000","dateStarted":"2025-07-25T10:15:33+0000","title":"Remove timestamp from ratings_df","results":{"code":"SUCCESS","msg":[]}},{"text":"%md \n### Make sure movielens20252026 keyspace is created and \"titles\", \"ratings\", \"users\" tables are created in the keyspace!","user":"anonymous","dateUpdated":"2025-07-25T10:23:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438620517_65012268","id":"20250725-101700_907540605","dateCreated":"2025-07-25T10:17:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9794","dateFinished":"2025-07-25T10:23:39+0000","dateStarted":"2025-07-25T10:23:39+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Make sure movielens20252026 keyspace is created and &ldquo;titles&rdquo;, &ldquo;ratings&rdquo;, &ldquo;users&rdquo; tables are created in the keyspace!</h3>\n"}]}},{"text":"%pyspark\r\n\r\ntitles_df.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens20252026\") \\\r\n    .mode(\"append\") \\\r\n    .save()","user":"anonymous","dateUpdated":"2025-07-25T10:13:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753437760178_-1216071875","id":"20250725-100240_1456672367","dateCreated":"2025-07-25T10:02:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9041","dateFinished":"2025-07-25T10:05:14+0000","dateStarted":"2025-07-25T10:05:12+0000","title":"Write titles_df to Cassandra","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nratings_df_clean.write \\\n    .format(\"org.apache.spark.sql.cassandra\") \\\n    .options(table=\"ratings\", keyspace=\"movielens20252026\") \\\n    .mode(\"append\") \\\n    .save()","user":"anonymous","dateUpdated":"2025-07-25T10:15:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438079299_-467090004","id":"20250725-100759_1759924589","dateCreated":"2025-07-25T10:07:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9367","dateFinished":"2025-07-25T10:15:40+0000","dateStarted":"2025-07-25T10:15:37+0000","title":"Save ratings_df to Cassandra","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nusers_df.write \\\n    .format(\"org.apache.spark.sql.cassandra\") \\\n    .options(table=\"users\", keyspace=\"movielens20252026\") \\\n    .mode(\"append\") \\\n    .save()","user":"anonymous","dateUpdated":"2025-07-25T10:16:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438109092_-1200959398","id":"20250725-100829_931534704","dateCreated":"2025-07-25T10:08:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9470","dateFinished":"2025-07-25T10:16:47+0000","dateStarted":"2025-07-25T10:16:44+0000","title":"Save users_df to Cassandra","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import SparkSession\r\n\r\n# Read back from Cassandra\r\ncheck_users_df = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"users\", keyspace=\"movielens20252026\") \\\r\n    .load()\r\n\r\ncheck_users_df.show(10)","user":"anonymous","dateUpdated":"2025-07-25T10:19:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438604238_-1051760548","id":"20250725-101644_170134053","dateCreated":"2025-07-25T10:16:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9726","dateFinished":"2025-07-25T10:19:25+0000","dateStarted":"2025-07-25T10:19:23+0000","title":"Read users_df from Cassandra","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+--------+\n|user_id|age|gender|occupation|zip_code|\n+-------+---+------+----------+--------+\n|    143| 42|     M|technician|   08832|\n|    909| 50|     F|  educator|   53171|\n|    468| 28|     M|  engineer|   02341|\n|    583| 44|     M|  engineer|   29631|\n|    403| 37|     M|     other|   06811|\n|    546| 36|     M| executive|   22911|\n|    771| 26|     M|   student|   15232|\n|    618| 15|     F|   student|   44212|\n|    411| 34|     M|  educator|   44691|\n|    471| 10|     M|   student|   77459|\n+-------+---+------+----------+--------+\nonly showing top 10 rows\n\n"}]}},{"text":"%pyspark\n\nfrom pyspark.sql import SparkSession\n\n# Read back from Cassandra\ncheck_titles_df = spark.read \\\n    .format(\"org.apache.spark.sql.cassandra\") \\\n    .options(table=\"titles\", keyspace=\"movielens20252026\") \\\n    .load()\n\ncheck_titles_df.show(10)","user":"anonymous","dateUpdated":"2025-07-25T10:20:36+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438763078_1930441857","id":"20250725-101923_472061380","dateCreated":"2025-07-25T10:19:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9879","dateFinished":"2025-07-25T10:20:05+0000","dateStarted":"2025-07-25T10:20:04+0000","title":"Read titles_df from Cassandra","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+--------------------+-------+-------+------------+-------+------+--------+--------------------+-------+------------------+---+-------+\n|movieid|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|film_noir|horror|            imdb_url|musical|mystery|release_date|romance|sci_fi|thriller|               title|unknown|video_release_date|war|western|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+--------------------+-------+-------+------------+-------+------+--------+--------------------+-------+------------------+---+-------+\n|    143|     0|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|http://us.imdb.co...|      1|      0| 01-Jan-1965|      0|     0|       0|Sound of Music, T...|      0|              null|  0|      0|\n|    909|     0|        0|        0|       0|     0|    0|          0|    1|      0|        0|     0|http://us.imdb.co...|      0|      0| 23-Jan-1998|      0|     0|       0|Dangerous Beauty ...|      0|              null|  0|      0|\n|    468|     0|        0|        0|       0|     0|    0|          0|    1|      0|        0|     0|http://us.imdb.co...|      0|      0| 01-Jan-1993|      0|     0|       0|         Rudy (1993)|      0|              null|  0|      0|\n|    583|     0|        0|        0|       0|     0|    1|          0|    0|      0|        0|     0|http://us.imdb.co...|      0|      0| 01-Jan-1993|      0|     0|       1|Romeo Is Bleeding...|      0|              null|  0|      0|\n|   1189|     0|        0|        0|       0|     0|    0|          0|    1|      0|        0|     0|http://us.imdb.co...|      0|      0| 24-Jan-1997|      0|     0|       0|  Prefontaine (1997)|      0|              null|  0|      0|\n|    403|     1|        1|        0|       0|     0|    1|          0|    1|      0|        0|     0|http://us.imdb.co...|      0|      0| 01-Jan-1989|      0|     0|       0|       Batman (1989)|      0|              null|  0|      0|\n|    546|     1|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|http://us.imdb.co...|      0|      0| 09-Feb-1996|      0|     0|       1| Broken Arrow (1996)|      0|              null|  0|      0|\n|   1049|     0|        0|        0|       0|     1|    0|          0|    0|      0|        0|     0|http://us.imdb.co...|      0|      0| 02-Aug-1996|      0|     0|       0| House Arrest (1996)|      0|              null|  0|      0|\n|   1327|     0|        0|        0|       0|     0|    0|          0|    1|      0|        0|     0|http://us.imdb.co...|      0|      0| 16-Sep-1994|      0|     0|       0|     Captives (1994)|      0|              null|  0|      0|\n|    771|     1|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|http://us.imdb.co...|      0|      0| 01-Jan-1995|      0|     1|       1|Johnny Mnemonic (...|      0|              null|  0|      0|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+--------------------+-------+-------+------------+-------+------+--------+--------------------+-------+------------------+---+-------+\nonly showing top 10 rows\n\n"}]}},{"text":"%pyspark\n\ncheck_ratings_df = spark.read \\\n    .format(\"org.apache.spark.sql.cassandra\") \\\n    .options(table=\"ratings\", keyspace=\"movielens20252026\") \\\n    .load()\n\ncheck_ratings_df.show(10)\n","user":"anonymous","dateUpdated":"2025-07-25T10:21:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438804621_-1071323089","id":"20250725-102004_1274896981","dateCreated":"2025-07-25T10:20:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9960","dateFinished":"2025-07-25T10:21:29+0000","dateStarted":"2025-07-25T10:21:27+0000","title":"Read ratings_df from Cassandra","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+\n|user_id|movieid|rating|\n+-------+-------+------+\n|    143|    258|     3|\n|    143|    271|     4|\n|    143|    272|     4|\n|    143|    286|     2|\n|    143|    288|     5|\n|    143|    294|     3|\n|    143|    307|     4|\n|    143|    313|     5|\n|    143|    315|     4|\n|    143|    322|     4|\n+-------+-------+------+\nonly showing top 10 rows\n\n"}]}},{"text":"%md\n## Q1: Calculate the average rating for each movie (Top 10 only)","user":"anonymous","dateUpdated":"2025-07-25T10:28:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753438887096_-651037728","id":"20250725-102127_1587385251","dateCreated":"2025-07-25T10:21:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10073","dateFinished":"2025-07-25T10:28:03+0000","dateStarted":"2025-07-25T10:28:03+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Q1: Calculate the average rating for each movie (Top 10 only)</h2>\n"}]}},{"text":"%pyspark\r\n\r\nratings_df_clean.createOrReplaceTempView(\"ratings\")\r\ntitles_df.createOrReplaceTempView(\"titles\")","user":"anonymous","dateUpdated":"2025-07-25T10:25:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439086576_782626974","id":"20250725-102446_1276201776","dateCreated":"2025-07-25T10:24:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10255","dateFinished":"2025-07-25T10:25:47+0000","dateStarted":"2025-07-25T10:25:46+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nspark.sql(\"\"\"\nSELECT \n    t.title, \n    ROUND(AVG(r.rating), 2) AS avg_rating, \n    COUNT(*) AS total_ratings\nFROM ratings r\nJOIN titles t ON r.movieid = t.movieid\nGROUP BY t.title\nORDER BY avg_rating DESC, total_ratings DESC\nLIMIT 10\n\"\"\").show(truncate=False)","user":"anonymous","dateUpdated":"2025-07-25T10:26:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439146353_1201896006","id":"20250725-102546_341076771","dateCreated":"2025-07-25T10:25:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10330","dateFinished":"2025-07-25T10:26:11+0000","dateStarted":"2025-07-25T10:26:05+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------------------------------------+----------+-------------+\n|title                                            |avg_rating|total_ratings|\n+-------------------------------------------------+----------+-------------+\n|Star Kid (1997)                                  |5.0       |3            |\n|Prefontaine (1997)                               |5.0       |3            |\n|Santa with Muscles (1996)                        |5.0       |2            |\n|Saint of Fort Washington, The (1993)             |5.0       |2            |\n|Aiqing wansui (1994)                             |5.0       |1            |\n|Marlene Dietrich: Shadow and Light (1996)        |5.0       |1            |\n|Someone Else's America (1995)                    |5.0       |1            |\n|Great Day in Harlem, A (1994)                    |5.0       |1            |\n|Entertaining Angels: The Dorothy Day Story (1996)|5.0       |1            |\n|They Made Me a Criminal (1939)                   |5.0       |1            |\n+-------------------------------------------------+----------+-------------+\n\n"}]}},{"text":"%md\n## Q2: Identify the top ten movies with the highest average ratings","user":"anonymous","dateUpdated":"2025-07-25T10:28:08+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439259132_-1827262733","id":"20250725-102739_1085385358","dateCreated":"2025-07-25T10:27:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10488","dateFinished":"2025-07-25T10:28:08+0000","dateStarted":"2025-07-25T10:28:08+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Q2: Identify the top ten movies with the highest average ratings</h2>\n"}]}},{"text":"%pyspark\n\nspark.sql(\"\"\"\nSELECT \n    t.title, \n    ROUND(AVG(r.rating), 2) AS avg_rating,\n    COUNT(*) AS num_ratings\nFROM ratings r\nJOIN titles t ON r.movieid = t.movieid\nGROUP BY t.title\nHAVING COUNT(*) >= 50\nORDER BY avg_rating DESC, num_ratings DESC\nLIMIT 10\n\"\"\").show(truncate=False)","user":"anonymous","dateUpdated":"2025-07-25T10:28:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439165400_-157021785","id":"20250725-102605_666767017","dateCreated":"2025-07-25T10:26:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10398","dateFinished":"2025-07-25T10:28:24+0000","dateStarted":"2025-07-25T10:28:22+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------------------------------------------+----------+-----------+\n|title                                                 |avg_rating|num_ratings|\n+------------------------------------------------------+----------+-----------+\n|Close Shave, A (1995)                                 |4.49      |112        |\n|Schindler's List (1993)                               |4.47      |298        |\n|Wrong Trousers, The (1993)                            |4.47      |118        |\n|Casablanca (1942)                                     |4.46      |243        |\n|Shawshank Redemption, The (1994)                      |4.45      |283        |\n|Wallace & Gromit: The Best of Aardman Animation (1996)|4.45      |67         |\n|Usual Suspects, The (1995)                            |4.39      |267        |\n|Rear Window (1954)                                    |4.39      |209        |\n|Star Wars (1977)                                      |4.36      |584        |\n|12 Angry Men (1957)                                   |4.34      |125        |\n+------------------------------------------------------+----------+-----------+\n\n"}]}},{"text":"%md\n#### Note: We added HAVING COUNT(*) >= 50 to avoid unfairly showing a movie that only got 1 rating of 5 stars","user":"anonymous","dateUpdated":"2025-07-25T10:29:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439302577_-175519857","id":"20250725-102822_2072707410","dateCreated":"2025-07-25T10:28:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10593","dateFinished":"2025-07-25T10:29:39+0000","dateStarted":"2025-07-25T10:29:39+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Note: We added HAVING COUNT(*) >= 50 to avoid unfairly showing a movie that only got 1 rating of 5 stars</h4>\n"}]}},{"text":"%md\n## Q3: Find users who rated at least 50 movies and identify their favourite movie genres","user":"anonymous","dateUpdated":"2025-07-25T10:30:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439426426_1396765008","id":"20250725-103026_339086402","dateCreated":"2025-07-25T10:30:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10775","dateFinished":"2025-07-25T10:30:55+0000","dateStarted":"2025-07-25T10:30:55+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Q3: Find users who rated at least 50 movies and identify their favourite movie genres</h2>\n"}]}},{"text":"%md\n#### Step 1: Identify Active Users (≥ 50 ratings)","user":"anonymous","dateUpdated":"2025-07-25T10:31:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439455835_1193663561","id":"20250725-103055_1190325246","dateCreated":"2025-07-25T10:30:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10841","dateFinished":"2025-07-25T10:31:17+0000","dateStarted":"2025-07-25T10:31:17+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 1: Identify Active Users (≥ 50 ratings)</h4>\n"}]}},{"text":"%pyspark\r\n\r\nactive_users_df = spark.sql(\"\"\"\r\nSELECT user_id, COUNT(*) AS total_rated\r\nFROM ratings\r\nGROUP BY user_id\r\nHAVING total_rated >= 50\r\n\"\"\")\r\nactive_users_df.createOrReplaceTempView(\"active_users\")\r\nactive_users_df.show(5)","user":"anonymous","dateUpdated":"2025-07-25T10:31:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439476900_-489781443","id":"20250725-103116_1508432409","dateCreated":"2025-07-25T10:31:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10915","dateFinished":"2025-07-25T10:31:34+0000","dateStarted":"2025-07-25T10:31:33+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------+\n|user_id|total_rated|\n+-------+-----------+\n|    148|         65|\n|    463|        133|\n|    496|        129|\n|    833|        267|\n|    243|         81|\n+-------+-----------+\nonly showing top 5 rows\n\n"}]}},{"text":"%md\n#### Step 2: Join with Ratings + Titles to get genre info","user":"anonymous","dateUpdated":"2025-07-25T10:31:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439493589_1888766906","id":"20250725-103133_1951304024","dateCreated":"2025-07-25T10:31:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10988","dateFinished":"2025-07-25T10:31:55+0000","dateStarted":"2025-07-25T10:31:55+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 2: Join with Ratings + Titles to get genre info</h4>\n"}]}},{"text":"%pyspark\n\nuser_genres_df = spark.sql(\"\"\"\nSELECT \n    r.user_id,\n    t.movieid,\n    t.action, t.adventure, t.animation, t.children, t.comedy,\n    t.crime, t.documentary, t.drama, t.fantasy, t.film_noir,\n    t.horror, t.musical, t.mystery, t.romance, t.sci_fi,\n    t.thriller, t.war, t.western\nFROM ratings r\nJOIN active_users au ON r.user_id = au.user_id\nJOIN titles t ON r.movieid = t.movieid\n\"\"\")\nuser_genres_df.createOrReplaceTempView(\"user_genres\")\nuser_genres_df.show(5)","user":"anonymous","dateUpdated":"2025-07-25T10:32:08+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439515932_207829610","id":"20250725-103155_1043872469","dateCreated":"2025-07-25T10:31:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11073","dateFinished":"2025-07-25T10:32:10+0000","dateStarted":"2025-07-25T10:32:08+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\n|user_id|movieid|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|film_noir|horror|musical|mystery|romance|sci_fi|thriller|war|western|\n+-------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\n|    186|    302|     0|        0|        0|       0|     0|    1|          0|    0|      0|        1|     0|      0|      1|      0|     0|       1|  0|      0|\n|     22|    377|     0|        0|        0|       1|     1|    0|          0|    0|      0|        0|     0|      0|      0|      0|     0|       0|  0|      0|\n|    244|     51|     0|        0|        0|       0|     0|    0|          0|    1|      0|        0|     0|      0|      0|      1|     0|       0|  1|      1|\n|    298|    474|     0|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|      0|      0|      0|     1|       0|  1|      0|\n|    115|    265|     1|        0|        0|       0|     0|    0|          0|    0|      0|        0|     0|      0|      0|      0|     0|       1|  0|      0|\n+-------+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+---------+------+-------+-------+-------+------+--------+---+-------+\nonly showing top 5 rows\n\n"}]}},{"text":"%md\n#### Step 3: Melt genre columns & find most frequent genre per user","user":"anonymous","dateUpdated":"2025-07-25T10:32:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439528380_955042622","id":"20250725-103208_56962790","dateCreated":"2025-07-25T10:32:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11152","dateFinished":"2025-07-25T10:32:30+0000","dateStarted":"2025-07-25T10:32:30+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 3: Melt genre columns &amp; find most frequent genre per user</h4>\n"}]}},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import expr\r\n\r\n# Unpivot genre columns into rows\r\nmelted_genres = user_genres_df.selectExpr(\r\n    \"user_id\",\r\n    \"stack(18, \\\r\n        'action', action, \\\r\n        'adventure', adventure, \\\r\n        'animation', animation, \\\r\n        'children', children, \\\r\n        'comedy', comedy, \\\r\n        'crime', crime, \\\r\n        'documentary', documentary, \\\r\n        'drama', drama, \\\r\n        'fantasy', fantasy, \\\r\n        'film_noir', film_noir, \\\r\n        'horror', horror, \\\r\n        'musical', musical, \\\r\n        'mystery', mystery, \\\r\n        'romance', romance, \\\r\n        'sci_fi', sci_fi, \\\r\n        'thriller', thriller, \\\r\n        'war', war, \\\r\n        'western', western) as (genre, liked)\"\r\n).filter(\"liked = 1\")\r\n\r\nmelted_genres.createOrReplaceTempView(\"user_genre_likes\")","user":"anonymous","dateUpdated":"2025-07-25T10:32:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439549803_660491886","id":"20250725-103229_959627849","dateCreated":"2025-07-25T10:32:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11239","dateFinished":"2025-07-25T10:32:41+0000","dateStarted":"2025-07-25T10:32:41+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%md\n#### Step 4: Count genre frequency per user & get favourite","user":"anonymous","dateUpdated":"2025-07-25T10:33:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439561358_-21637266","id":"20250725-103241_1822120671","dateCreated":"2025-07-25T10:32:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11312","dateFinished":"2025-07-25T10:33:03+0000","dateStarted":"2025-07-25T10:33:03+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 4: Count genre frequency per user &amp; get favourite</h4>\n"}]}},{"text":"%pyspark\n\nspark.sql(\"\"\"\nSELECT user_id, genre, COUNT(*) AS genre_count\nFROM user_genre_likes\nGROUP BY user_id, genre\n\"\"\").createOrReplaceTempView(\"user_genre_counts\")\n\nspark.sql(\"\"\"\nSELECT user_id, genre AS favorite_genre, genre_count\nFROM (\n    SELECT user_id, genre, genre_count,\n           ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY genre_count DESC) as rn\n    FROM user_genre_counts\n) WHERE rn = 1\nLIMIT 10\n\"\"\").show()","user":"anonymous","dateUpdated":"2025-07-25T10:33:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439583413_526260492","id":"20250725-103303_1920328761","dateCreated":"2025-07-25T10:33:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11378","dateFinished":"2025-07-25T10:33:18+0000","dateStarted":"2025-07-25T10:33:13+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------+-----------+\n|user_id|favorite_genre|genre_count|\n+-------+--------------+-----------+\n|    243|         drama|         59|\n|    392|         drama|         57|\n|    540|         drama|         28|\n|    897|        action|         57|\n|    255|      thriller|         42|\n|    481|        comedy|         26|\n|    588|         drama|         95|\n|    804|        comedy|        105|\n|    322|         drama|         24|\n|    918|         drama|         54|\n+-------+--------------+-----------+\n\n"}]}},{"text":"%md\n## Q4: Display all users who are less than 20 years old","user":"anonymous","dateUpdated":"2025-07-25T10:33:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439593453_710201115","id":"20250725-103313_1149192981","dateCreated":"2025-07-25T10:33:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11451","dateFinished":"2025-07-25T10:33:53+0000","dateStarted":"2025-07-25T10:33:53+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Q4: Display all users who are less than 20 years old</h2>\n"}]}},{"text":"%md\n#### Step 1: Register users_df as a Temp View","user":"anonymous","dateUpdated":"2025-07-25T10:35:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439686254_-1572759296","id":"20250725-103446_1573495387","dateCreated":"2025-07-25T10:34:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11612","dateFinished":"2025-07-25T10:35:05+0000","dateStarted":"2025-07-25T10:35:05+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 1: Register users_df as a Temp View</h4>\n"}]}},{"text":"%pyspark\nusers_df.createOrReplaceTempView(\"users\")","user":"anonymous","dateUpdated":"2025-07-25T10:35:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439705454_-1316116456","id":"20250725-103505_755776009","dateCreated":"2025-07-25T10:35:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11678","dateFinished":"2025-07-25T10:35:15+0000","dateStarted":"2025-07-25T10:35:15+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%md\n#### Step 2: Query users under 20","user":"anonymous","dateUpdated":"2025-07-25T10:35:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439714821_-823622539","id":"20250725-103514_43247062","dateCreated":"2025-07-25T10:35:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11751","dateFinished":"2025-07-25T10:35:34+0000","dateStarted":"2025-07-25T10:35:34+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Step 2: Query users under 20</h4>\n"}]}},{"text":"%pyspark\n\nspark.sql(\"\"\"\nSELECT * \nFROM users \nWHERE age < 20\nORDER BY age ASC\n\"\"\").show(20, truncate=False)","user":"anonymous","dateUpdated":"2025-07-25T10:35:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439734079_600964720","id":"20250725-103534_1571926623","dateCreated":"2025-07-25T10:35:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11808","dateFinished":"2025-07-25T10:35:44+0000","dateStarted":"2025-07-25T10:35:44+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+--------+\n|user_id|age|gender|occupation   |zip_code|\n+-------+---+------+-------------+--------+\n|30     |7  |M     |student      |55436   |\n|471    |10 |M     |student      |77459   |\n|289    |11 |M     |none         |94619   |\n|142    |13 |M     |other        |48118   |\n|628    |13 |M     |none         |94306   |\n|674    |13 |F     |student      |55337   |\n|609    |13 |F     |student      |55106   |\n|880    |13 |M     |student      |83702   |\n|206    |14 |F     |student      |53115   |\n|813    |14 |F     |student      |02136   |\n|887    |14 |F     |student      |27249   |\n|179    |15 |M     |entertainment|20755   |\n|101    |15 |M     |student      |05146   |\n|281    |15 |F     |student      |06059   |\n|461    |15 |M     |student      |98102   |\n|618    |15 |F     |student      |44212   |\n|849    |15 |F     |student      |25652   |\n|57     |16 |M     |none         |84010   |\n|434    |16 |F     |student      |49705   |\n|451    |16 |M     |student      |48446   |\n+-------+---+------+-------------+--------+\nonly showing top 20 rows\n\n"}]}},{"text":"%md\n## Q5: Display users who are scientists and aged between 30 and 40","user":"anonymous","dateUpdated":"2025-07-25T10:36:15+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439744254_-1836419562","id":"20250725-103544_1745089516","dateCreated":"2025-07-25T10:35:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11881","dateFinished":"2025-07-25T10:36:15+0000","dateStarted":"2025-07-25T10:36:15+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Q5: Display users who are scientists and aged between 30 and 40</h2>\n"}]}},{"text":"%pyspark\n\nspark.sql(\"\"\"\nSELECT * \nFROM users\nWHERE occupation = 'scientist'\nAND age BETWEEN 30 AND 40\nORDER BY age\n\"\"\").show(truncate=False)","user":"anonymous","dateUpdated":"2025-07-25T10:36:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439775621_1882239854","id":"20250725-103615_505568724","dateCreated":"2025-07-25T10:36:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11966","dateFinished":"2025-07-25T10:36:26+0000","dateStarted":"2025-07-25T10:36:26+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+--------+\n|user_id|age|gender|occupation|zip_code|\n+-------+---+------+----------+--------+\n|538    |31 |M     |scientist |21010   |\n|730    |31 |F     |scientist |32114   |\n|554    |32 |M     |scientist |62901   |\n|272    |33 |M     |scientist |53706   |\n|183    |33 |M     |scientist |27708   |\n|543    |33 |M     |scientist |95123   |\n|874    |36 |M     |scientist |37076   |\n|337    |37 |M     |scientist |10522   |\n|40     |38 |M     |scientist |27514   |\n|430    |38 |M     |scientist |98199   |\n|71     |39 |M     |scientist |98034   |\n|107    |39 |M     |scientist |60466   |\n|74     |39 |M     |scientist |T8H1N   |\n|643    |39 |M     |scientist |55122   |\n|309    |40 |M     |scientist |70802   |\n|918    |40 |M     |scientist |70116   |\n+-------+---+------+----------+--------+\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2025-07-25T10:36:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753439786382_-680572569","id":"20250725-103626_439282706","dateCreated":"2025-07-25T10:36:26+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12039"}],"name":"STQD6324_Assignment3_P146219","id":"2M2P6K99Z","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}